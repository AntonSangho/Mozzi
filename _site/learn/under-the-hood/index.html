<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.12.0 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Mozzi</title>
<meta name="description" content="audio synthesis library for Arduino">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="Mozzi">
<meta property="og:title" content="Mozzi">
<meta property="og:url" content="https://localhost:4000/Mozzi/learn/under-the-hood/">


  <meta property="og:description" content="audio synthesis library for Arduino">



  <meta property="og:image" content="https://localhost:4000/Mozzi/assets/images/mozzi-square.png">









  

  


<link rel="canonical" href="https://localhost:4000/Mozzi/learn/under-the-hood/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Tim Barrass",
      "url": "https://localhost:4000/Mozzi",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/Mozzi/feed.xml" type="application/atom+xml" rel="alternate" title="Mozzi Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Mozzi/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/Mozzi/">Mozzi</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="https://localhost:4000/Mozzi/download/" >download</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://localhost:4000/Mozzi/gallery/" >gallery</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://localhost:4000/Mozzi/examples/" >examples</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://localhost:4000/Mozzi/learn/" >learn</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://localhost:4000/Mozzi/faq/" >faq</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://localhost:4000/Mozzi/blog/" >blog</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://localhost:4000/Mozzi/doc/html/" >api</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://github.com/sensorium/Mozzi" >github</a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      
  











<div class="page__hero--overlay"
  style=" background-image: url('/Mozzi/assets/images/mozzi-square.png');"
>
  
    <div class="wrapper">
      <h1 class="page__title" itemprop="headline">
        
          Mozzi

        
      </h1>
      
        <p class="page__lead">audio synthesis library for Arduino
</p>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    
    <meta itemprop="description" content="audio synthesis library for Arduino">
    
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
        <p>The interface between Mozzi and the Arduino environment consists of four main
functions. These are <code class="highlighter-rouge">startMozzi()</code>, <code class="highlighter-rouge">updateAudio()</code>, <code class="highlighter-rouge">updateControl()</code> and
<code class="highlighter-rouge">audioHook()</code>, visible in the “User space” section in the figure below. All four are
required for a Mozzi sketch to compile.</p>

<p><img src="images/Mozzi-system.jpg" alt="Mozzi system architecture" /></p>

<p><code class="highlighter-rouge">startMozzi(control_rate)</code> goes in Arduino’s <code class="highlighter-rouge">setup()</code>. It starts the control and
audio output timers, given the requested control rate in Hz as a parameter,
or defaulting to 64 Hz without a parameter.</p>

<p><code class="highlighter-rouge">updateControl()</code> is where any analog or digital input sensing code should be placed and
relatively slow changes such as LFO’s or frequency changes can be performed.</p>

<p><code class="highlighter-rouge">updateAudio()</code> is where audio synthesis code should be placed. This runs on
average 16384 times per second, so code here needs to be lean. The only other
strict requirement is that it returns an integer between -244 and 243 inclusive
in STANDARD mode or -8192 to 8191 in HIFI mode.</p>

<p><code class="highlighter-rouge">audioHook()</code> goes in Arduino’s <code class="highlighter-rouge">loop()</code>. It wraps <code class="highlighter-rouge">updateAudio()</code> and takes care of
filling the output buffer, hiding the details of this from user space.</p>

<p>Mozzi uses hardware interrupts on the processor which automatically call
interrupt service routines (ISR) at regular intervals. <code class="highlighter-rouge">startMozzi()</code> sets
up two interrupts, one for audio output at a sample rate of 16384 Hz and a
control interrupt which can be set by the user at 64 Hz or more, in powers of
two.</p>

<p>In <code class="highlighter-rouge">STANDARD</code> mode, the internal timers used by Mozzi on the ATmega
processors are the 16 bit Timer 1 for audio and 8 bit Timer 0 for control.</p>

<p><code class="highlighter-rouge">HIFI</code> mode additionally employs Timer 2 with Timer 1 for audio.</p>

<p>Using Timer 0 disables Arduino time functions <code class="highlighter-rouge">millis()</code>, <code class="highlighter-rouge">micros()</code>, <code class="highlighter-rouge">delay()</code>
and <code class="highlighter-rouge">delayMicroseconds()</code>. This saves processor time which would be spent on the
interrupts and the blocking action of the <code class="highlighter-rouge">delay()</code> functions. Replacements for
these functions are listed on the Mozzi home page under Caveats and Workarounds.</p>

<p>The output buffer has 256 cells which equates to a maximum latency of about 15
milliseconds, to give leeway for control operations without interrupting audio
output. The buffer is emptied behind the scenes by the regular 16384 Hz audio
interrupt.</p>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
    
    
    <li><a href="/Mozzi/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Tim Barrass. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/Mozzi/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>








  </body>
</html>